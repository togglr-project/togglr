<!DOCTYPE html>
<html>
<head>
    <title>Environment ID Debug</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .log { margin: 5px 0; padding: 5px; border-left: 3px solid #ccc; }
        .error { border-left-color: #f00; background: #ffe6e6; }
        .success { border-left-color: #0f0; background: #e6ffe6; }
        .info { border-left-color: #00f; background: #e6f3ff; }
        .section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Environment ID Debug Tool</h1>
    <div id="logs"></div>
    
    <div class="section">
        <h3>Test Environment Selector</h3>
        <select id="env-selector" name="environment">
            <option value="">Select Environment</option>
            <option value="1">Development</option>
            <option value="2">Staging</option>
            <option value="3">Production</option>
        </select>
        <button onclick="testEnvId()">Test envId Detection</button>
    </div>
    
    <div class="section">
        <h3>Test with Data Attributes</h3>
        <div data-environment-id="1" data-env-id="1">Environment 1</div>
        <div data-environment-id="2" data-env-id="2">Environment 2</div>
    </div>
    
    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = new Date().toISOString() + ': ' + message;
            document.getElementById('logs').appendChild(div);
            console.log(message);
        }
        
        function testEnvId() {
            log('=== Testing envId Detection ===', 'info');
            
            // Test localStorage
            const localStorageKeys = [
                'currentEnvId',
                'selectedEnvironmentId', 
                'environmentId',
                'env_id',
                'activeEnvironmentId'
            ];
            
            log('localStorage values:', 'info');
            localStorageKeys.forEach(key => {
                const value = localStorage.getItem(key);
                log(`  ${key}: ${value || 'not found'}`, value ? 'success' : 'error');
            });
            
            // Test URL parsing
            const path = window.location.pathname;
            const envMatch = path.match(/\/projects\/[^\/]+\/([^\/]+)/);
            if (envMatch && envMatch[1]) {
                log(`Found envId in URL: ${envMatch[1]}`, 'success');
            } else {
                log('No envId found in URL', 'error');
            }
            
            // Test query parameters
            const urlParams = new URLSearchParams(window.location.search);
            const queryEnvId = urlParams.get('env_id') || urlParams.get('environment_id');
            if (queryEnvId) {
                log(`Found envId in query params: ${queryEnvId}`, 'success');
            } else {
                log('No envId found in query params', 'error');
            }
            
            // Test DOM selectors
            const envSelect = document.querySelector('select[name*="env"], select[id*="env"], [data-testid*="env"]');
            if (envSelect && envSelect.value) {
                log(`Found envId in DOM selector: ${envSelect.value}`, 'success');
            } else {
                log('No envId found in DOM selector', 'error');
            }
            
            // Test data attributes
            const envElements = document.querySelectorAll('[data-environment-id], [data-env-id]');
            if (envElements.length > 0) {
                envElements.forEach((el, index) => {
                    const envId = el.getAttribute('data-environment-id') || el.getAttribute('data-env-id');
                    log(`Found envId in data attribute [${index}]: ${envId}`, 'success');
                });
            } else {
                log('No envId found in data attributes', 'error');
            }
            
            // Test all select elements
            const allSelects = document.querySelectorAll('select');
            log(`Found ${allSelects.length} select elements:`, 'info');
            allSelects.forEach((select, index) => {
                log(`  [${index}] name="${select.name}" id="${select.id}" value="${select.value}"`, 'info');
            });
        }
        
        // Set up some test data
        localStorage.setItem('currentProjectId', 'test-project');
        localStorage.setItem('currentEnvId', '1');
        
        // Test on page load
        testEnvId();
    </script>
</body>
</html>
