- name: basic error report without auto-disable
  fixtures:
    - empty_db
    - sdk_base

  steps:
    - name: first_error
      request:
        method: POST
        path: /sdk/v1/features/new_ui/report-error
        headers:
          Content-Type: application/json
          Authorization: 545C3E6A-8B17-4204-9558-9106D33B56F7
        body: {"error_type":"timeout","error_message":"Service X timeout"}
      response:
        status: 200
        headers:
          Content-Type: application/json
        json: |
          {
            "feature_key": "new_ui",
            "environment_key": "prod",
            "enabled": true,
            "auto_disabled": false,
            "error_rate": 0.0,
            "threshold": 0,
            "last_error_at": "<<PRESENCE>>"
          }
      dbChecks:
        - query: SELECT COUNT(*) as cnt FROM monitoring.error_reports WHERE feature_id = '22222222-2222-2222-2222-222222222222' AND environment_id = 1
          result:
            - cnt: 1
        - query: SELECT enabled FROM feature_params WHERE feature_id = '22222222-2222-2222-2222-222222222222' AND environment_id = 1
          result:
            - enabled: true
