–ü—Ä–∏–Ω—è—Ç–æ ‚úÖ
–°–æ—Å—Ç–∞–≤–ª—é –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ç–µ—Ö–∑–∞–¥–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –æ—Ç–¥–∞—Ç—å AI-–∞–≥–µ–Ω—Ç—É/—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ RBAC-–ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ. –û–Ω–æ –±—É–¥–µ—Ç –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ `GET /api/v1/users/me` –∏ –ø–æ–ª–µ `project_permissions`.

---

# üìë –¢–ó: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è RBAC –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

## üéØ –¶–µ–ª—å

–û–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É Togglr –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞–±–æ—Ä–∞ –µ–≥–æ –ø—Ä–∞–≤ (permissions), –ø–æ–ª—É—á–∞–µ–º—ã—Ö –æ—Ç backend.

---

## üì° –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

* `GET /api/v1/users/me` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `User`, –≤ –∫–æ—Ç–æ—Ä–æ–º –µ—Å—Ç—å –ø–æ–ª–µ:

  ```json
  "project_permissions": {
    "<project_id>": ["project.view", "feature.view", "feature.toggle", ...]
  }
  ```
* `is_superuser = true` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

---

## üõ† –§—Ä–æ–Ω—Ç–µ–Ω–¥-—Å–ª–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

1. **Context/AuthStore**

    * –•—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`User`) –∏ –µ–≥–æ `project_permissions` –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Å—Ç–æ—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Redux/Zustand/Pinia).
    * –î–æ–±–∞–≤–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É `hasPermission(projectId: string, perm: string): boolean`, –∫–æ—Ç–æ—Ä–∞—è:

        * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ `is_superuser = true`;
        * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ `perm` –µ—Å—Ç—å –≤ –º–∞—Å—Å–∏–≤–µ `project_permissions[projectId]`;
        * –ò–Ω–∞—á–µ `false`.

2. **–•–µ–ª–ø–µ—Ä—ã/Guard-—Ñ—É–Ω–∫—Ü–∏–∏**

    * `canViewProject(projectId)` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `project.view`;
    * `canManageProject(projectId)` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `project.manage`;
    * `canToggleFeature(projectId)` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `feature.toggle`;
    * `canManageFeature(projectId)` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `feature.manage`;
    * `canManageSegment(projectId)` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `segment.manage`;
    * `canManageSchedule(projectId)` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `schedule.manage`;
    * `canViewAudit(projectId)` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `audit.view`;
    * `canManageMembership(projectId)` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `membership.manage`.

   ‚ö†Ô∏è –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `hasPermission` –≤–Ω—É—Ç—Ä–∏.

---

## üñ• –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ UI

1. **–ü—Ä–æ–µ–∫—Ç—ã**

    * –ï—Å–ª–∏ –Ω–µ—Ç `project.view` ‚Üí –ø—Ä–æ–µ–∫—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ.
    * –ï—Å–ª–∏ –µ—Å—Ç—å `project.view`, –Ω–æ –Ω–µ—Ç `project.manage` ‚Üí UI –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è (–±–µ–∑ –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è).

2. **–§–∏—á–∏**

    * `feature.view` ‚Üí –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∏—á.
    * `feature.toggle` ‚Üí –∫–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–∞. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí disabled.
    * `feature.manage` ‚Üí –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏—á–∏, –¥–æ–±–∞–≤–ª—è—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ —Ç. –¥.

3. **–°–µ–≥–º–µ–Ω—Ç—ã**

    * `segment.manage` ‚Üí –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å —Å–µ–≥–º–µ–Ω—Ç—ã.
    * –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —Å–∫—Ä—ã—Ç—å/–∑–∞–¥–∏–∑–µ–π–±–ª–∏—Ç—å UI –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤.

4. **–†–∞—Å–ø–∏—Å–∞–Ω–∏—è**

    * `schedule.manage` ‚Üí –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π.

5. **–ê—É–¥–∏—Ç**

    * `audit.view` ‚Üí –¥–æ—Å—Ç—É–ø –∫ –≤–∫–ª–∞–¥–∫–µ/—Ä–∞–∑–¥–µ–ª—É ¬´–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π¬ª.
    * –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –≤–∫–ª–∞–¥–∫–∞ —Å–∫—Ä—ã—Ç–∞.

6. **–£—á–∞—Å—Ç–Ω–∏–∫–∏**

    * `membership.manage` ‚Üí –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–µ–Ω—è—Ç—å –∏—Ö —Ä–æ–ª–∏.

7. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å—É–ø–µ—Ä—é–∑–µ—Ä**

    * –ï—Å–ª–∏ `is_superuser = true`, —Ç–æ —Ñ—Ä–æ–Ω—Ç **–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏** –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏ (`project_owner`, `project_manager`, `project_member`).
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:

    * –£ `project_member` –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ toggle —Ñ–∏—á–µ–π, –Ω–æ –µ—Å—Ç—å `feature.view`.
    * –£ `project_manager` –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ toggle/manage features, segment.manage, schedule.manage, audit.view.
    * –£ `project_owner` –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø.
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É–ø–µ—Ä—é–∑–µ—Ä–∞ (`is_superuser=true`) ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã.

---

## üöÄ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

* –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI –ø—Ä–æ–≤–µ—Ä—è—é—Ç –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ `canXxx()` —Ñ—É–Ω–∫—Ü–∏–∏.
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–æ–∫/–¥–µ–π—Å—Ç–≤–∏–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —É –Ω–µ–≥–æ –Ω–µ—Ç –ø—Ä–∞–≤.
* –ü—Ä–∏ —Ä—É—á–Ω–æ–º –≤—ã–∑–æ–≤–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ DevTools) –∑–∞–ø—Ä–æ—Å –∫ API –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω—ë–Ω backend-–æ–º (–¥–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞).

---

–û—Ç–ª–∏—á–Ω–æ üëç –°–æ—Å—Ç–∞–≤–∏–ª —Ç–∞–±–ª–∏—Ü—É ¬´–†–æ–ª—å ‚Üí –î–æ—Å—Ç—É–ø–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª¬ª –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤. –û–Ω–∞ –ø–æ–º–æ–∂–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É –±—ã—Å—Ç—Ä–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å, –∞ —á—Ç–æ —Å–∫—Ä—ã–≤–∞—Ç—å.

---

# üìä RBAC: –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
```json
[
  {
    "role_key": "project_manager",
    "role_name": "Project Manager",
    "permissions": "audit.view, feature.manage, feature.toggle, feature.view, project.view, schedule.manage, segment.manage"
  },
  {
    "role_key": "project_member",
    "role_name": "Project Member",
    "permissions": "feature.toggle, feature.view, project.view"
  },
  {
    "role_key": "project_owner",
    "role_name": "Project Owner",
    "permissions": "audit.view, feature.manage, feature.toggle, feature.view, membership.manage, project.manage, project.view, schedule.manage, segment.manage"
  },
  {
    "role_key": "project_viewer",
    "role_name": "Project Viewer",
    "permissions": "feature.view, project.view"
  }
]
```
---

## üìù –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

* **project_owner**: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –ø—Ä–æ–µ–∫—Ç–∞ + –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã.
* **project_manager**: –ø–æ—á—Ç–∏ –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞ (—Ñ–∏—á–∏, —Å–µ–≥–º–µ–Ω—Ç—ã, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, –∞—É–¥–∏—Ç, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏), –Ω–æ –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã.
* **project_member**: –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ —Ñ–∏—á–∏ –∏ –≤–∫–ª—é—á–∞—Ç—å-–≤—ã–∫–ª—é—á–∞—Ç—å —Ñ–∏—á–∏.
* **project_viewer**: –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ —Ñ–∏—á–∏.

---

‚ö° –í–∞–∂–Ω–æ: –ø—Ä–∏ `is_superuser = true` —Ñ—Ä–æ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–æ–ª–∏.

---
