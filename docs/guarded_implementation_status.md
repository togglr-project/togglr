# üìä –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Guarded Workflow

## ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

### üîß **–ë—ç–∫–µ–Ω–¥ (Backend)**

#### ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `pending_changes` —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `pending_change_entities` –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `project_approvers` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–ø–ø—Ä—É–≤–µ—Ä–æ–≤
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `project_settings` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### ‚úÖ **API Endpoints**
- ‚úÖ `GET /api/v1/pending_changes` - —Å–ø–∏—Å–æ–∫ pending changes
- ‚úÖ `GET /api/v1/pending_changes/{id}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ pending change
- ‚úÖ `POST /api/v1/pending_changes/{id}/approve` - –æ–¥–æ–±—Ä–µ–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π TOTP
- ‚úÖ `POST /api/v1/pending_changes/{id}/reject` - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
- ‚úÖ `POST /api/v1/pending_changes/{id}/cancel` - –æ—Ç–º–µ–Ω–∞
- ‚úÖ `POST /api/v1/pending_changes/{id}/initiate-totp` - –∏–Ω–∏—Ü–∏–∞—Ü–∏—è TOTP —Å–µ—Å—Å–∏–∏

#### ‚úÖ **Feature Operations (Guarded)**
- ‚úÖ `Toggle` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ enabled/disabled
- ‚úÖ `Update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Ñ–∏—á–∏
- ‚úÖ `Delete` - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∏—á–∏
- ‚úÖ `UpdateWithChildren` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏

#### ‚úÖ **Guard Service**
- ‚úÖ `IsFeatureGuarded` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–µ–≥–∞ 'guarded'
- ‚úÖ `IsEntityGuarded` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π
- ‚úÖ `GetProjectActiveUserCount` - –ø–æ–¥—Å—á–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ `CheckEntityConflict` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

#### ‚úÖ **Pending Changes Service**
- ‚úÖ `Create` - —Å–æ–∑–¥–∞–Ω–∏–µ pending change
- ‚úÖ `List` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- ‚úÖ `GetByID` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ ID
- ‚úÖ `Approve` - –æ–¥–æ–±—Ä–µ–Ω–∏–µ —Å TOTP –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ `Reject` - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
- ‚úÖ `Cancel` - –æ—Ç–º–µ–Ω–∞
- ‚úÖ `InitiateTOTPApproval` - —Å–æ–∑–¥–∞–Ω–∏–µ TOTP —Å–µ—Å—Å–∏–∏

#### ‚úÖ **TOTP Authentication**
- ‚úÖ `VerifyTOTP` - –ø—Ä–æ–≤–µ—Ä–∫–∞ TOTP –∫–æ–¥–∞
- ‚úÖ `InitiateTOTPApproval` - —Å–æ–∑–¥–∞–Ω–∏–µ 2FA —Å–µ—Å—Å–∏–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π 2FA —Å–∏—Å—Ç–µ–º–æ–π

#### ‚úÖ **Business Logic**
- ‚úÖ Single-user auto-approve (‚â§1 –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- ‚úÖ Multi-user approval workflow
- ‚úÖ Conflict detection (–Ω–µ–ª—å–∑—è –∏–º–µ—Ç—å 2 pending –Ω–∞ –æ–¥–Ω—É —Å—É—â–Ω–æ—Å—Ç—å)
- ‚úÖ Transactional apply (–∞—Ç–æ–º–∞—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- ‚úÖ Audit log integration
- ‚úÖ Guarded tag detection (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è category_type)

### üé® **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (Frontend)**

#### ‚úÖ **–°—Ç—Ä–∞–Ω–∏—Ü—ã**
- ‚úÖ `PendingChangesPage` - –ø–æ–ª–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è pending changes
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `ProjectPage` —Å GuardResponseHandler
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ sidebar —Å badge —Å—á–µ—Ç—á–∏–∫–æ–º

#### ‚úÖ **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- ‚úÖ `PendingChangeCard` - –∫–∞—Ä—Ç–æ—á–∫–∞ pending change —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏
- ‚úÖ `ApprovalDialog` - –¥–∏–∞–ª–æ–≥ –æ–¥–æ–±—Ä–µ–Ω–∏—è —Å TOTP –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ `GuardResponseHandler` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç guard workflow
- ‚úÖ `FeatureCard` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

#### ‚úÖ **UX Features**
- ‚úÖ **–í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**: –æ—Ä–∞–Ω–∂–µ–≤—ã–π —á–∏–ø "Pending" –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö —Ñ–∏—á–µ–π
- ‚úÖ **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏**: Edit/Delete –æ—Ç–∫–ª—é—á–µ–Ω—ã –¥–ª—è pending —Ñ–∏—á–µ–π
- ‚úÖ **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å**: Switch –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è pending —Ñ–∏—á–µ–π
- ‚úÖ **–í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏**: –æ—Ä–∞–Ω–∂–µ–≤–∞—è —Ä–∞–º–∫–∞ –∏ —Ñ–æ–Ω
- ‚úÖ **Tooltips —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏**: –ø–æ—á–µ–º—É –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ **Badge —Å—á–µ—Ç—á–∏–∫**: –≤ sidebar –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ pending changes

#### ‚úÖ **–î–∏–∞–ª–æ–≥–∏**
- ‚úÖ `FeatureDetailsDialog` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å pending –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
- ‚úÖ `EditFeatureDialog` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è pending —Ñ–∏—á–µ–π
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏—á–∞—Ö

#### ‚úÖ **Hooks & State Management**
- ‚úÖ `usePendingChanges` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ pending changes
- ‚úÖ `usePendingChange` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ pending change
- ‚úÖ `useApprovePendingChange` - –æ–¥–æ–±—Ä–µ–Ω–∏–µ
- ‚úÖ `useRejectPendingChange` - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
- ‚úÖ `useCancelPendingChange` - –æ—Ç–º–µ–Ω–∞
- ‚úÖ `usePendingChangesCount` - —Å—á–µ—Ç—á–∏–∫ –¥–ª—è badge
- ‚úÖ `useProjectPendingChanges` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö—É–∫ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ `useFeatureHasPendingChanges` - –ø—Ä–æ–≤–µ—Ä–∫–∞ pending –¥–ª—è —Ñ–∏—á–∏
- ‚úÖ `useFeatureNames` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —Ñ–∏—á–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

#### ‚úÖ **API Integration**
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAPI —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–æ–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ 202 —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è pending changes
- ‚úÖ TOTP workflow —Å session management
- ‚úÖ Error handling –∏ loading states

---

## ‚ùå **–ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã)**

### üö® **Feature Schedules Guard Workflow**
- ‚ùå `CreateFeatureSchedule` - –ù–ï–¢ guard –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚ùå `UpdateFeatureSchedule` - –ù–ï–¢ guard –ø—Ä–æ–≤–µ—Ä–∫–∏  
- ‚ùå `DeleteFeatureSchedule` - –ù–ï–¢ guard –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚ùå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è GuardResponseHandler –≤ `ProjectSchedulingPage`

### üö® **–î—Ä—É–≥–∏–µ Entity Types**
- ‚ùå **Rules**: –ù–ï–¢ guard –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª
- ‚ùå **Flag Variants**: –ù–ï–¢ guard –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- ‚ùå **Tags**: –ù–ï–¢ guard –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ç–µ–≥–æ–≤

### üö® **–£–ª—É—á—à–µ–Ω–∏—è UX**
- ‚ùå **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ù–ï–¢ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ pending changes
- ‚ùå **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ù–ï–¢ email –¥–ª—è –∞–ø–ø—Ä—É–≤–µ—Ä–æ–≤ - !!!–º–æ–∂–Ω–æ –ø–æ–∫–∞ –Ω–µ –¥–µ–ª–∞—Ç—å!!!.
- ‚ùå **WebSocket**: –ù–ï–¢ real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

## üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|-----------|-------------|----------------|---------|
| **Core Backend** | ‚úÖ | ‚ùå | 100% |
| **Feature Operations** | ‚úÖ | ‚ùå | 100% |
| **API Endpoints** | ‚úÖ | ‚ùå | 100% |
| **TOTP Authentication** | ‚úÖ | ‚ùå | 100% |
| **Core Frontend** | ‚úÖ | ‚ùå | 100% |
| **Feature UX** | ‚úÖ | ‚ùå | 100% |
| **Feature Schedules** | ‚ùå | ‚úÖ | 0% |
| **Rules/Variants/Tags** | ‚ùå | ‚úÖ | 0% |
| **Notifications** | ‚ùå | ‚úÖ | 0% |

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: ~85%**

---

## üéØ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏**

### üî• **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**

#### 1. **Feature Schedules Guard Workflow**
- –î–æ–±–∞–≤–∏—Ç—å guard –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `CreateFeatureSchedule`
- –î–æ–±–∞–≤–∏—Ç—å guard –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `UpdateFeatureSchedule`  
- –î–æ–±–∞–≤–∏—Ç—å guard –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `DeleteFeatureSchedule`
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å GuardResponseHandler –≤ `ProjectSchedulingPage`

### ü•à **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**

#### 2. **Rules Guard Workflow**
- –î–æ–±–∞–≤–∏—Ç—å guard –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `EditFeatureDialog`

#### 3. **Flag Variants Guard Workflow**
- –î–æ–±–∞–≤–∏—Ç—å guard –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `EditFeatureDialog`

### ü•â **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**

#### 4. **Tags Guard Workflow**
- –î–æ–±–∞–≤–∏—Ç—å guard –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ç–µ–≥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 5. **–£–ª—É—á—à–µ–Ω–∏—è UX**
- WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

## üèÜ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

**Guarded Workflow —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ 85%** –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∏—á–∞–º–∏:

‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç:**
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏—á–µ–π (toggle)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏—á–µ–π (update)
- –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∏—á–µ–π (delete)
- Single-user auto-approve —Å TOTP
- Multi-user approval workflow
- –ü–æ–ª–Ω—ã–π UX —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
- Conflict detection –∏ prevention

‚ùå **–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:**
- Feature Schedules (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- Rules/Variants/Tags (–≤–∞–∂–Ω–æ)
